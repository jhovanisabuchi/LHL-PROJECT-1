Question 1: Explore the total revenue generated and the number of visit by visitors from every city and country within each month and year,


```SQL Queries:
with sales_revenue as (--sales revenue for every transaction made by each visitor
    select 
	     fullvisitorid,
		 (unitprice::bigint/1000000) as unitprice ,-- devide by 1000000 as instracted in the project
		  unitssold,
         ((unitprice::bigint/1000000) * unitssold) as sales_rev
	from analytics
	where unitssold is not null and -- to avoid miscalculations
          unitprice is not null and 
		  unitprice > 0 )

select   country, 
          city, 
		  count(a.visitid) as visit_count, 
		  sum(sales_rev) as total_revenue,
         extract(month from(to_date(s.date::text,'yyyymmdd'))) as month,-- eatract the month and format the date to date format
		 extract(year from(to_date(s.date::text,'yyyymmdd'))) as year
   from all_sessions s
      join analytics a using (fullvisitorid)
       join sales_revenue using (fullvisitorid)

     where city not in ('not available in demo dataset', '(not set)')and -- to avoid cities and countries with missing data
	       country not in ('(not set)')
      group by country,
	            city, 
				extract(month from(to_date(s.date::text,'yyyymmdd'))),
                extract(year from(to_date(s.date::text,'yyyymmdd')))
     order by visit_count desc,
	           total_revenue desc
            ;```
  
  
  

Answer: 
![Screenshot 2024-11-07 040559](https://github.com/user-attachments/assets/eca57219-e8b6-4676-b013-e851d03838ea)



Question 2: Which cities and countries have the highest and lowest average customer sentiment scores,and Is there any pattern between sentiment scores and the total revenue generated in those locations? 


```SQL Queries:
with Revenue as (
    select 
	      fullvisitorid,
	       (unitprice::bigint/1000000) as unitprice , 
	        unitssold,
           ((unitprice::bigint/1000000) * unitssold) as sales_revenue
	from analytics
	where  unitssold is not null and 
            unitprice is not null and 
			unitprice > 0 )

select   
    country, 
	city, 
	sum(sales_revenue) as total_revenue,
    round(avg(sentimentscore),2)as avg_sentimentscore
      
from all_sessions s
   join Revenue using (fullvisitorid)
   join products using (productsku)

where city not in ('not available in demo dataset', '(not set)') and 
        country not in ('(not set)')
group by country,city
order by total_revenue desc
;```



Answer:
![Screenshot 2024-11-07 040716](https://github.com/user-attachments/assets/992da540-14ce-4720-8c2c-bfebbda57fbc)



Question 3: Identify customers with the highest number of visits, identify if there are any visits without placing orders


```SQL Queries:
select 
       distinct a.fullvisitorid, 
        count(distinct a.visitid) as visit_count, --number of visitis by visitor
		 coalesce(sum (distinct p.ordered_quantity),0) as order_count -- number of products ordered by visitor
from analytics a
   join all_sessions s using (fullvisitorid)
   left join products p using (productsku) -- left join to include visits without orders
group by fullvisitorid
order by visit_count desc -- now we can easily identify visits without orders by 
                           --having order_count = 0```



Answer:
![Screenshot 2024-11-07 040925](https://github.com/user-attachments/assets/3ac648eb-4582-4131-b9ef-eef7a21bb12d)



Question 4: Determine the top 10 best-selling products and the revenue generated by each products?

```SQL Queries:
with product_details as (          -- create cte to get the revenue of each product
        select  distinct trim(leading from(initcap(v2productname))) as productname, --to standardize the pproductname
		         productsku,
		      coalesce((unitprice::bigint / 1000000 ),0) as unitprice,--divide by 1000000 to get the real price and cast to 0 to avoid nulls
	          coalesce(unitssold,0) as unitssold,       --cast to 0 to avoid nulls
			( coalesce((unitprice::bigint / 1000000 ),0)*  coalesce(unitssold,0)) as revenue 
		from all_sessions s
		    left join analytics a
		      using (fullvisitorid)
		          )
select 
    distinct p.productname,
	 sum(unitssold) as total_ordered,
	 sum(revenue) as total_revenue
from product_details pd
join products p
using (productsku)
group by p.productname
order by total_revenue desc,
         total_ordered desc
		limit 10```


Answer:

![Screenshot 2024-11-07 041032](https://github.com/user-attachments/assets/c10e1ab1-ef53-48a1-99fe-72c91b362254)



